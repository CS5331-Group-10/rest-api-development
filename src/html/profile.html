<html>
<head>
	<title>My Secret Diary</title>
	<meta charset="utf-8">
 	<link rel="stylesheet" href="./css/bootstrap.min.css">
	<link rel="stylesheet" href="./css/stylesheet.css">
    <link rel="stylesheet" href = "./css/bootstrap-table.min.css">
  <script src="./js/jquery-3.3.1.min.js"></script>
        <script src="./js/bootstrap.min.js"></script>
        <script src="./js/bootstrap-table.min.js"></script>

</head>
<body onload="getData()">
  <nav class="navbar navbar-expand-sm bg-light navbar-blue">
    <ul class="navbar-nav">
    <ul class="navbar-nav">
      <li class="nav-item active">
        <a class="nav-link" id="public_diary" href="#">public diary</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" id="private_entry" href="#">private diary</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" id="create_entry" href="#">Create new</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" id="delete_entry" href="#">Delete diary</a>
      </li>
      <li class="nav-item active">
        <a class="nav-link" id="adjust_entry" href="#">Adjust permission</a>
      </li>
    </ul>
    <ul class="nav navbar-nav navbar-right">
    <li><a id="user_info" href="#"><span class="glyphicon-user"></span>Profile</a></li>
          <li><a id="user_expire" href="#"><span class="glyphicon-log-in">Signout</span></a></li>
    </ul>
</nav> 

 	<div class="container jumbo-container">
  		<div class="jumbotron">
    		<h1>Profile</h1>      
    		<p>See your information here</p>
          <div id="demo_content">
         </div>
  		</div>
	</div>

	<div class="container">
		<div id="profile"></div>
	</div>


        
       
	<script type="text/javascript">
  var token = window.location.search.substring(1);
  var formData = `{\"token\": "${token}"}`;
  $.ajax({
              url: 'http://localhost:8080/users',
              type : "POST",
              contentType: "application/json",
              data : formData,
              dataType: 'json',
              success: function(data) {
                if (data.status) {
                  console.log(data.result.name);

                  var output = "<ul><li>Name:" +data.result.name + "</li>";
                  console.log(output);
                  output += "<li>Fullname:" +data.result.fullname + "</li>";
                  output += "<li>Age" +data.result.age + "</li></ul>";
                  document.getElementById("demo_content").innerHTML = output;
                    }
              else {
                      // alert("Invalid authentication token.");
                       // window.location.href = "index.html";
                    }
                  },
              error: function(jqXHR, textStatus, errorThrown){
                  alert('Error: ' + textStatus + ' - ' + errorThrown);
              }
          });

   $("#user_info").click(function() {
      window.location.href = `profile.html?${token}`;
    });

   $("#public_diary").click(function() {
      window.location.href = `public_entry_auth.html?${token}`;
    });

    $("#private_entry").click(function() {
      window.location.href = `private_entry.html?${token}`;
    });

    $("#create_entry").click(function() {
      window.location.href = `create_entry.html?${token}`;
    });

    $("#delete_entry").click(function() {
      window.location.href = `delete_entry.html?${token}`;
    });

    $("#adjust_entry").click(function() {
      window.location.href = `adjust_entry.html?${token}`;
    });


  $("#user_expire").on('click', function(e){
    e.preventDefault();
    e.returnValue = false;
    // send ajax
    $.ajax({
        url: 'http://localhost:8080/users/expire', // url where to submit the request
        type : "POST", // type of action POST || GET
        dataType : 'json', // data type
        data : formData,
        contentType: "application/json",
        success : function(data) {

            console.log(data);

            if (data.status == true)
            {
                // redirect to the index page
              alert("Successfully logged out");
              window.location.href= "index.html";
            }
            else if (data.status == false)
            {
                 // have some issues, need to fix
              alert("Already logged out");
              window.location.href = "index.html";
            }

        },
        error: function(xhr, resp, text) {
            console.log(xhr, resp, text);
        }
    })
  });
	</script>
	
    </div>
</body>
</html>

