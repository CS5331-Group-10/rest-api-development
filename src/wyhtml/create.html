<html>
<head>

<script src="./jquery.js"></script>
<script src="./shared.js"></script>
<script>
$(document).ready(function(){
	tokencookie = getCookie("token");
	tokendata = JSON.stringify({token:tokencookie});
	$.ajax({
		url: 'http://localhost:8080/users', // url where to submit the request
		type : "POST", // type of action POST || GET
		dataType : 'json', // data type
		data : tokendata,
		contentType: "application/json",
		success : function(data){
		    if (data.status == true) {		
		    	$("#f").css("display","block")
		    }
		    else {
			window.location= "/"
		    }

		},
		error: function(xhr, resp, text) {
		    console.log(xhr, resp, text);
		}
	});

	// click on button submit
	$("#submit").on('click', function(e){
		var title = $("#title").val()
		var pub = $("#public").is(':checked')
		pub = (pub==true)?1:0
		var text = $("#text").val()
		var formdata = JSON.stringify({title:title,public:pub,text:text, token:tokencookie});
		
		create(formdata);
	});
});

function create(formdata) {
	// send ajax
	$.ajax({
		url: 'http://localhost:8080/diary/create', // url where to submit the request
		type : "POST", // type of action POST || GET
		dataType : 'json', // data type
		data : formdata,
		contentType: "application/json",
		success : function(data) {

		    console.log(data.status);
		    if (data.status == true)
		    {
		    	alert("Post created!");
			window.location= "./diary.html"
		    }
		    else
		    {
		       alert(data.error);
		       console.log(data.error)
		      //window.location= "./login.html";
		    }

		},
		error: function(xhr, resp, text) {
		    console.log(xhr, resp, text);
		}
	});

}
</script>

</head>
<body>
<form id ="f" style:"display:hidden">
Title: <input id='title' type='text'>
Public <input id='public' type='checkbox'><br>
Text: <input id='text' type='textarea'><br>

<input id='submit' type='button' value='submit'>
</form>


<a href="/">home</a>

</body>
</html>
